---
layout : post
title : 실무로 통하는 인과추론 CH5
categories : 쿠다ML심화
---
## CH5. 성향점수
이번 장에서는 성향점수 가중치를 이용하여 편향을 제거하는 방법을 살펴볼 것이다. (이진, 이산형 처치 있을 때 적합)


1. 문제 상황
- 목표: **관리자 교육(처치, T)** → **직원 참여도(결과, Y)** 인과효과 추정
- 문제: 교육 여부와 참여도에 동시에 영향을 주는 **공변량(X)** 존재 → 단순 비교 시 **편향 발생**

2. 공변량 조절의 의미
- 공변량을 모형에 포함해 **가짜 상관(비인과적 경로)** 제거
- 회귀모형 예시:
$  
\[
Y = \beta_0 + \beta_1 T + \beta_2 X + \epsilon
\]
$
- 여기서 $\(\beta_1\)$: 공변량 효과를 제거한 후 교육의 순수 효과

3. 계수 보정(Coefficient Adjustment)
- 공변량을 통제하면 $\(T\)$의 효과 계수($\$(\beta_1\$))$가 **보정된 효과**로 추정됨
- 이 과정을 흔히 **계수 보정**이라고 부름
- 다른 방법: 성향점수매칭, 층화, 가중치(IPW) 등도 가능하지만, 회귀모형에서의 조절이 가장 기본적임

**성향점수**

1. 정의
- 성향점수:
$$
e(X) = P(T=1 \mid X)
$$
공변량 $X$ 가 주어졌을 때 처치(교육)를 받을 확률.

- 조건부 독립성(CIA):
$$
(Y(0), Y(1)) \perp T \mid X
$$

<img width="400" height="150" alt="image" src="https://github.com/user-attachments/assets/5ebcdcfe-ef31-4933-a1c4-accbf7bc185d" />

2. 의미
- 공변량 $X$ 전체를 통제하는 대신, **$e(X)$** 하나로 요약해도 동일한 효과.  
- 즉, 성향점수는 **무작위 실험처럼 비교 가능**하게 해주는 도구.

3. “통제한다”의 실제 의미
- 성향점수 값 (예: $0.8$, $0.2$)을 **하나로 바꾸는 게 아님**.  
- 대신 분석에서 활용:
  - **매칭(Matching):** 비슷한 $e(X)$ 가진 처치군–통제군 비교  
  - **층화(Stratification):** $e(X)$ 구간별 층으로 나눠 비교  
  - **가중치(IPW):** $1/e(X)$ 또는 $1/(1-e(X))$ 등을 가중치로 부여해 집단 분포를 맞춤  

**성향점수 추정** : 실제 성향점수는 알 수 없는 이상적인 값이다. 현실에서는 처치 배정 메커니즘을 대부분 알 수 없으며, 실제 성향점수 e(x)를 추정값으로 대체해야 한다.

**성향점수와 직교화** 

| 구분 | OLS | 성향점수 |
|------|-------------------------------|---------------------------------------------|
| 목적 | 교란 변수 통제 후 처치 효과 추정 | 교란 변수 통제 후 처치 효과 추정 |
| 방법 | $X$를 회귀식에 직접 포함해 계수 보정 | $X$를 $e(X)$로 요약하여 매칭·가중치 등으로 균형화 |
| 결과 | $\beta_1$: 보정된 처치 효과 | ATT/ATE 추정치: 무작위화된 것처럼 비교 |

**성향점수 매칭**

e(X) = P(D=1|X) 계산 후, 처치군 개체(D=1)과 비처치군 개체 (D=0)을 **비슷한 성향점수**를 가진 쌍으로 매칭하여, 무작위 실험에서처럼 공변량이 비슷한 집단 간 비교를 가능하게 하는 방법

=> 대조군의 knn 모델을 통해 실험군의 짝을 찾고, 실험군의 knn 모델을 이용해 대조군의 짝을 찾는다. 각 실험 대상에 짝이 지어졌다면, 다음과 같이 ATE 추정 가능

**역확률 가중치**

성향점수를 활용하는 역확률 가중치 (IPW) : 처치의 역확률에 따라 데이터의 가중치를 재조정하여 해당 데이터에서 처치가 무작위 배정된 것처럼 보이게 할 수 있음.

성향점수가 높을수록(=처치받을 확률이 큰 집단) 처치군은 “덜 대표적”이므로 → 작은 가중치

성향점수가 낮을수록(=처치받을 확률이 작은 집단) 처치군은 “희귀한 케이스”라서 → 큰 가중치

이러한 성향점수를 이용해 **ATE** 구할 수 있음

**역확률 가중치의 분산**

추정의 불안정성: IPW는 편향을 줄여주지만, 분산이 너무 크면 신뢰구간이 넓어져서 “효과가 있다/없다” 결론을 내리기 힘듦.

Bias-Variance Tradeoff: IPW는 unbiased estimator로 알려져 있지만, 효율성(efficiency)이 떨어질 수 있음.

=> 큰 가중치 (희귀한 놈들) 가 적용되면 성향점수 추정량의 분산이 크게 증가함








